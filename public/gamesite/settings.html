<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Glitch - Settings</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    .settings-card {
      background: var(--bg-secondary);
      border-radius: var(--border-radius);
      box-shadow: 0 4px 24px rgba(0,0,0,0.16);
      padding: 2.5rem 2rem 2rem 2rem;
      width: 100%;
      max-width: 480px;
      margin: 2.5rem auto;
      color: var(--text-primary);
    }
    .settings-card h2 {
      margin-top: 0;
      font-size: 2rem;
      color: var(--accent);
      letter-spacing: 1px;
    }
    .setting-group { margin-bottom: 2.2rem; }
    .setting-group h3 {
      margin: 0 0 0.5rem 0;
      color: var(--accent);
      font-size: 1.2rem;
      font-weight: 600;
      letter-spacing: 0.5px;
    }
    .setting-item { margin-bottom: 1.1rem; }
    .setting-item label {
      display: block;
      margin-bottom: 0.3rem;
      font-weight: 500;
      cursor: pointer;
    }
    .setting-item input[type='text'],
    .setting-item input[type='file'],
    .setting-item select {
      width: 100%;
      padding: 0.7rem;
      border-radius: var(--border-radius);
      border: 1px solid rgba(255,255,255,0.08);
      background: var(--bg-primary);
      color: var(--text-primary);
      font-family: inherit;
      transition: background 0.2s, color 0.2s, border-color 0.2s;
      font-size: 1rem;
      box-sizing: border-box;
    }
    .setting-item input[type='file'] { padding: 0.4rem 0.5rem; }
    .setting-item input[type='checkbox'] { margin-right: 0.5rem; vertical-align: middle; }
    .preview-container {
      width: 100%;
      height: 150px;
      border-radius: var(--border-radius);
      background: var(--bg-primary);
      background-size: cover;
      background-position: center;
      margin-top: 0.6rem;
      border: 1px dashed rgba(255,255,255,0.14);
      transition: background-image 0.2s;
    }
    .reset-button {
      background: var(--accent);
      color: #fff;
      border: none;
      border-radius: var(--border-radius);
      padding: 0.7rem 1.2rem;
      font-size: 1rem;
      cursor: pointer;
      margin-top: 0.8rem;
      transition: background 0.2s;
      font-weight: 600;
    }
    .reset-button:hover { background: #a084e8; }
    .about-section {
      margin-top: 1.6rem;
      color: var(--text-secondary);
      font-size: 1rem;
      text-align: center;
    }
    .theme-select {
      width: 100%;
      padding: 0.7rem;
      border-radius: var(--border-radius);
      border: 1px solid rgba(255,255,255,0.08);
      background: var(--bg-primary);
      color: var(--text-primary);
      font-family: inherit;
      font-size: 1rem;
      margin-bottom: 0.6rem;
    }
  </style>
</head>
<body>
  <header>
    <div class="logo">
      <img src="../assets/images/logo_trans.png" alt="Logo" /> Glitch
    </div>
    <nav>
      <a href="index.html">Home</a>
      <a href="games.html">Games</a>
      <a href="chat.html">Chat</a>
      <a href="tabs.html">Tabs</a>
      <a href="settings.html" class="active">Settings</a>
    </nav>
  </header>
  <main>
    <section class="settings-card" aria-label="Settings">
      <h2>Settings</h2>

      <div class="setting-group">
        <h3>Theme</h3>
        <div class="setting-item">
          <label for="themeSelect">Choose Theme</label>
          <select id="themeSelect" class="theme-select" aria-label="Theme select">
            <option value="dark">Dark</option>
            <option value="light">Light</option>
            <option value="pink">Pink</option>
            <option value="solarized">Solarized</option>
            <option value="blue">Blue</option>
            <option value="midnight">Midnight</option>
            <option value="forest">Forest</option>
            <option value="ocean">Ocean</option>
            <option value="peach">Peach</option>
            <option value="lavender">Lavender</option>
            <option value="emerald">Emerald</option>
            <option value="sunset">Sunset</option>
            <option value="sky">Sky</option>
            <option value="mint">Mint</option>
            <option value="sand">Sand</option>
            <option value="coffee">Coffee</option>
            <option value="candy">Candy</option>
            <option value="grape">Grape</option>
            <option value="retro">Retro</option>
            <option value="blossom">Blossom</option>
            <option value="lemon">Lemon</option>
            <option value="slate">Slate</option>
            <option value="moss">Moss</option>
            <option value="velvet">Velvet</option>
            <option value="papaya">Papaya</option>
            <option value="noir">Noir</option>
            <option value="arctic">Arctic</option>
            <option value="blossomNight">Blossom Night</option>
            <option value="clay">Clay</option>
            <option value="denim">Denim</option>
            <option value="flamingo">Flamingo</option>
            <option value="aqua">Aqua</option>
            <option value="cream">Cream</option>
            <option value="raspberry">Raspberry</option>
            <option value="cyprus">Cyprus</option>
            <option value="mono">Mono</option>
            <option value="jellybean">Jellybean</option>
          </select>
        </div>
      </div>

      <div class="setting-group">
        <h3>Panic Image</h3>
        <div class="setting-item">
          <label for="panicImageUpload">Upload Panic Image</label>
          <input type="file" id="panicImageUpload" accept="image/*"/>
        </div>
        <div class="setting-item">
          <label for="panicImageUrl">Panic Image URL (optional)</label>
          <input type="text" id="panicImageUrl"/>
        </div>
        <div class="setting-item">
          <label for="panicKey">Panic Key</label>
          <input type="text" id="panicKey" maxlength="1" placeholder="e.g. P" style="width: 60px;"/>
        </div>
        <div class="setting-item">
          <label for="panicExitKey">Exit Panic Key</label>
          <input type="text" id="panicExitKey" maxlength="1" placeholder="e.g. Q" style="width: 60px;"/>
        </div>
        <div class="preview-container" id="panicImagePreview" aria-label="Panic image preview"></div>
      </div>
      <button class="reset-button" id="resetSettingsBtn">Reset Settings</button>

    </section>
  </main>
  <script>
    // --- THEME ---

    // --- PANIC IMAGE ---
    const panicImageUpload = document.getElementById('panicImageUpload');
    const panicImageUrl = document.getElementById('panicImageUrl');
    const panicImagePreview = document.getElementById('panicImagePreview');
    const panicKeyInput = document.getElementById('panicKey');
    // --- THEME ---
    const themeSelect = document.getElementById('themeSelect');
    themeSelect.value = localStorage.getItem('theme') || 'dark';
    themeSelect.addEventListener('change', function() {
      localStorage.setItem('theme', this.value);
      window.dispatchEvent(new Event('themechange'));
    });
    window.addEventListener('storage', function(e) {
      if (e.key === 'theme') {
        themeSelect.value = localStorage.getItem('theme') || 'dark';
      }
    });

    const panicExitKeyInput = document.getElementById('panicExitKey');
    function updatePanicPreview() {
      const panicImage = localStorage.getItem('gamesite_panic_image') || '';
      if (panicImage) {
        panicImagePreview.style.backgroundImage = `url(${panicImage})`;
        if (!panicImage.startsWith('data:')) {
          panicImageUrl.value = panicImage;
        } else {
          panicImageUrl.value = '';
        }
      } else {
        panicImagePreview.style.backgroundImage = '';
        panicImageUrl.value = '';
      }
      panicKeyInput.value = localStorage.getItem('gamesite_panic_key') || '';
      panicExitKeyInput.value = localStorage.getItem('gamesite_panic_exit_key') || '';
    }
    updatePanicPreview();
    panicImageUpload.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (event) => {
          localStorage.setItem('gamesite_panic_image', event.target.result);
          panicImagePreview.style.backgroundImage = `url(${event.target.result})`;
          panicImageUrl.value = '';
        };
        reader.readAsDataURL(file);
      }
    });
    panicImageUrl.addEventListener('input', () => {
      const url = panicImageUrl.value.trim();
      if (url) {
        localStorage.setItem('gamesite_panic_image', url);
        panicImagePreview.style.backgroundImage = `url(${url})`;
      } else {
        panicImagePreview.style.backgroundImage = '';
        localStorage.removeItem('gamesite_panic_image');
      }
    });
    panicKeyInput.addEventListener('input', () => {
      localStorage.setItem('gamesite_panic_key', panicKeyInput.value.trim());
    });
    panicExitKeyInput.addEventListener('input', () => {
      localStorage.setItem('gamesite_panic_exit_key', panicExitKeyInput.value.trim());
    });

    // --- RESET ---
    document.getElementById('resetSettingsBtn').addEventListener('click', () => {
      localStorage.removeItem('theme');
      localStorage.removeItem('gamesite_wallpaper');
      localStorage.removeItem('gamesite_panic_image');
      localStorage.removeItem('gamesite_panic_key');
      localStorage.removeItem('gamesite_panic_exit_key');
      themeSelect.value = 'dark';
      wallpaperPreview.style.backgroundImage = `url(../assets/images/wallpaper.webp)`;
      wallpaperSelect.value = 'default';
      panicImagePreview.style.backgroundImage = '';
      panicImageUrl.value = '';
      panicKeyInput.value = '';
      panicExitKeyInput.value = '';
    });

    // --- Live preview on storage change (for multi-tab) ---
    window.addEventListener('storage', function(e) {
      if (['gamesite_panic_image', 'gamesite_panic_key', 'gamesite_panic_exit_key'].includes(e.key)) {
        updatePanicPreview();
      }
      if (e.key === 'theme') {
        themeSelect.value = localStorage.getItem('theme') || 'dark';
      }
    });
  </script>
  <script src="theme.js"></script>
</body>
</html>